jenkins:
  clouds:
    - kubernetes:
        name: "kubernetes"
        namespace: "jenkins-agent"

        jenkinsUrl: "http://10.0.30.246:8080"

        webSocket: true

        templates:
          - name: "gradle-agent"
            label: "gradle-agent"
            idleMinutes: 1

            yaml: |
              spec:
                serviceAccountName: jenkins-agent-sa

                tolerations:
                  - key: "role"
                    operator: "Equal"
                    value: "ci"
                    effect: "NoSchedule"

                affinity:
                  nodeAffinity:
                    requiredDuringSchedulingIgnoredDuringExecution:
                      nodeSelectorTerms:
                        - matchExpressions:
                            - key: role
                              operator: In
                              values:
                                - ci

                volumes:
                  - name: gradle-cache
                    persistentVolumeClaim:
                      claimName: gradle-cache-pvc

                containers:
                  - name: "jnlp"
                    image: "jenkins/inbound-agent:latest"
                    resources:
                      requests:
                        memory: "512Mi"
                        cpu: "200m"

                  - name: "gradle"
                    image: "gradle:8-jdk17"
                    command: ["cat"]
                    tty: true
                    resources:
                      requests:
                        memory: "2Gi"
                        cpu: "500m"
                      limits:
                        memory: "4Gi"
                        cpu: "2"
                    volumeMounts:
                      - name: gradle-cache
                        mountPath: /gradle-cache

                  - name: "aws-cli"
                    image: "amazon/aws-cli:2.15.0"
                    command: ["cat"]
                    tty: true
                    resources:
                      requests:
                        memory: "256Mi"
                        cpu: "100m"
                
